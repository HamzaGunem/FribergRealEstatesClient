@*Made by Samuel*@
@page "/realtor/search"
@inject IRealtorService realtorService
@inject NavigationManager navManager


<PageTitle>Sök Mäklare</PageTitle>
<div class="m-4 container-large">
	<MudGrid>
		<!-- Generic SearchBox -->
		<MudItem xs="12" sm="4">
			<GenericSearchBox 
			_searchTerm="@_searchTerm"
			_searchTitle="@_setSearchBoxTitle"
			OnSearch="SearchRealtors" >
			</GenericSearchBox>
		</MudItem>

		<!-- Buffer/ space column -->
		<MudItem xs="1"></MudItem>

		<!-- Realtor Profile Card Grid -->
		<MudItem xs="12" sm="7" Style="background-color: darkgrey; border-radius: 10px" Class="p-2">
			<MudGrid>
				@if (_searching)
				{
					<MudProgressCircular Indeterminate="true" Color="Color.Primary" />
				}
				else if (_searchPerformed && !_getRealtors.Any())
				{
					<MudAlert Severity="Severity.Info">@_errorMessage @_searchTerm</MudAlert>
				}
				else
				{
					@foreach (var person in _getRealtors)
					{
						<MudItem xs="12" sm="6" md="4"
						@onclick="@(() => NavigateToPerson(person.Id))"
						style="cursor: pointer;
								 transition: transform 0.3s ease-in-out;"
						onmouseover="this.style.transform='scale(1.05)'"
						onmouseout="this.style.transform='scale(1)'">
							<RealtorProfileCard RealtorDto="person"></RealtorProfileCard>
						</MudItem>
					}
				}
			</MudGrid>
		</MudItem>
	</MudGrid>
</div>

@code {
	private List<RealtorSummaryDto> _getRealtors = new();

	private string _searchTerm = string.Empty;

	private string _errorMessage = $"Inga mäklare hittades i ";
	private string _setSearchBoxTitle = "Sök mäklare i stad/ commun";

	private bool _searching = false;
	private bool _searchPerformed = false;


	private async Task SearchRealtors(string term)
	{
		_searching = true;
		_searchPerformed = false;
		StateHasChanged();

		await Task.Delay(500);
		_searchTerm = term;
		if(!string.IsNullOrWhiteSpace(_searchTerm))
			_getRealtors = await realtorService.GetAllByCity(_searchTerm);


		_searching = false;
		_searchPerformed = true;
		StateHasChanged();
	}

	private void NavigateToPerson(int id)
	{
		navManager.NavigateTo($"/realtor/{id}");
	}
}
