@*Auth Hamza*@
@page "/profile"
@inject IRealtorService realtorService

<div class="container-large">
    @if (realtor != null)
    {
        <RealtorProfileCard realtorDto="@realtor.Realtor"></RealtorProfileCard>

        <div style="display: flex; justify-content: center; align-items: center; gap: 20px;">
            <MudChart ChartType="ChartType.Donut" Width="300px" Height="300px" InputData="@chartData" InputLabels="@chartLabels">
                <CustomGraphics>
                    <text class="donut-inner-text" x="50%" y="35%" dominant-baseline="middle" text-anchor="middle" fill="black" font-family="Helvetica" font-size="20">Total</text>
                    <text class="donut-inner-text" x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" fill="black" font-family="Helvetica" font-size="50">@totalSoldAndActive</text>
                </CustomGraphics>
            </MudChart>
        </div>

        foreach (var item in realtor.ActiveAdverts)
        {
            <RealtorActiveAdvert Advert="@item"></RealtorActiveAdvert>
        }
        foreach (var item in realtor.SoldAdverts)
        {
            <div style="color: red">
                <h2 style="color:red">Sold</h2>
                <RealtorActiveAdvert Advert="@item"></RealtorActiveAdvert>
            </div>
        }
    }
</div>

@code {
    private RealtorFullProfileDto realtor;
    private double[] chartData;
    private string[] chartLabels;
    private int totalSoldAndActive;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            realtor = await realtorService.GetMyProfileAsync();

            int totalAdverts = realtor.ActiveAdverts.Count() + realtor.SoldAdverts.Count();
            int activeAdverts = realtor.ActiveAdverts.Count();
            int soldAdverts = realtor.SoldAdverts.Count();

            totalSoldAndActive = activeAdverts + soldAdverts;

            chartData = new double[]
            {
                activeAdverts,
                soldAdverts,
            };

            // Set chart labels
            chartLabels = new string[]
            {
                $"Active Adverts: {activeAdverts}",
                $"Sold Adverts: {soldAdverts}",
            };
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error fetching profile: {ex.Message}");
        }
    }
}
